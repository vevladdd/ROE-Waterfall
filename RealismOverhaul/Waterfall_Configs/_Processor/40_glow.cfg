// Shorthand for adding a glow at the same position as the main plume.
// For glows that require further manual configuration, use an `ExtraTemplate` node.
@PART[*]:HAS[@ROWaterfall:HAS[#glow]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        +TEMPLATE:HAS[#__ro_waterfall_main]
        {
            !__ro_waterfall_main = delete
            __ro_waterfall_glow = true
            @templateName = #$/ROWaterfall/glow$
            @templateName ^= :^(.*)$:waterfall-nozzle-glow-$1-1:
            // Stretch in z, while accounting for any z-stretching in the main plume itself.
            // Twice the average scale of x and y.
            @scale[2] = #$scale[0]$
            @scale[2] += #$scale[1]$
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-hydrolox-lower-2]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 1.28
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-hydrolox-lower-3]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 1.28
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-hydrolox-lower-4]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 1.28
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-hydrolox-rs25-1]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            __tmp = 0.025
            @__tmp *= #$/ROWaterfall/scale[2]$
            @position[2] -= #$__tmp$
            @scale[*],* *= 0.92
            !__tmp = delete
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-hypergolic-aerozine50-upper-1]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 1.125
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-kerolox-lower-4]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 0.406
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-kerolox-lower-5*]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 0.406
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-kerolox-lower-RD170-1]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @scale[*],* *= 0.406
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-kerolox-upper-3]]]:FOR[zROWaterfall_40_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        @TEMPLATE:HAS[#__ro_waterfall_glow]
        {
            @position[2] -= 0.1
            @scale[*],* *= 0.5
        }
    }
}
