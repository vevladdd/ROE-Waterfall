@PART[*]:HAS[@ROWaterfall]:FOR[ROWaterfall_0_MainEffect]
{
    @description ^= :$: Plume configured by Waterfall-RO.:

    !EFFECTS {}

    MODULE
    {
        __ro_waterfall_main = true
        name = ModuleWaterfallFX
        moduleID = #$/name$
        CONTROLLER
        {
            name = atmosphereDepth
            linkedTo = atmosphere_density
        }
        CONTROLLER
        {
            name = throttle
            linkedTo = throttle
        }
        CONTROLLER
        {
            name = random
            linkedTo = random
            range = 0,1
        }
        TEMPLATE
        {
            templateName = #$/ROWaterfall/template$
            overrideParentTransform = #$/ROWaterfall/transform$
            position = #$/ROWaterfall/position$
            rotation = #$/ROWaterfall/rotation$
            scale = #$/ROWaterfall/scale$
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#engineID]]:FOR[ROWaterfall_0_MainEffect]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        engineID = #$/ROWaterfall/engineID$
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#template[waterfall-ntr-lh2-1]]]:AFTER[ROWaterfall_0_MainEffect]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        !CONTROLLER[random] {}
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#glow]]:FOR[ROWaterfall_1_Glow]
{
    +MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_main]
    {
        !__ro_waterfall_main = delete
        __ro_waterfall_glow = true
        @moduleID ^= :$:_glow:
        !CONTROLLER,* {}
        CONTROLLER
        {
            name = throttle
            linkedTo = throttle
        }
        @TEMPLATE {
            @templateName = #$/ROWaterfall/glow$
            @templateName ^= :^(.*)$:waterfall-nozzle-glow-$1-1:
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#glow_position]]:AFTER[ROWaterfall_1_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_glow]
    {
        @TEMPLATE {
            @position = #$/ROWaterfall/glow-position$
        }
    }
}

@PART[*]:HAS[@ROWaterfall:HAS[#glow_rotation]]:AFTER[ROWaterfall_1_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_glow]
    {
        @TEMPLATE {
            @rotation = #$/ROWaterfall/glow-rotation$
        }
    }
}


@PART[*]:HAS[@ROWaterfall:HAS[#glow_scale]]:AFTER[ROWaterfall_1_Glow]
{
    @MODULE[ModuleWaterfallFX]:HAS[#__ro_waterfall_glow]
    {
        @TEMPLATE {
            @scale = #$/ROWaterfall/glow-scale$
        }
    }
}
